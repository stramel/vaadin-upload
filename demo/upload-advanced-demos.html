<dom-module id="upload-advanced-demos">
  <template>
    <style>
       :host {
        display: block;
      }

    </style>


    <h3>Custom File List</h3>
    <p>
      <strong>TODO:</strong> Figure out why status isn't properly displaying.
    </p>
    <vaadin-demo-snippet id='upload-advanced-demos-custom-file-list'>
      <template preserve-content>
        <dom-bind>
          <template is="dom-bind">

            <vaadin-upload-multiple id="fileEventsDemo"
              files="{{files}}"
            ></vaadin-upload-multiple>
            <vaadin-upload-ajax-uploader
              files="{{files}}"
              url="https://httpbin.org/post"
              auto
              hidden
            ></vaadin-upload-ajax-uploader>
            <h4>Files</h4>
            <ul>
              <template is="dom-repeat" items="[[files]]" as="file">
                <li>
                  <strong>[[file.name]]</strong>
                  [[file.status]]
                </li>
              </template>
            </ul>

          </template>
        </dom-bind>
      </template>
    </vaadin-demo-snippet>


    <h3>Customizing the AJAX Uploader Request</h3>
    <p>
      Customize the upload request using the available upload-events
    </p>
    <p>
      <strong>NOTE:</strong> Different uploaders may expose some or all of these events
    </p>
    <vaadin-demo-snippet id='upload-advanced-demos-customizing-the-upload-request'>
      <template preserve-content>

        <vaadin-upload-multiple
          files="{{files}}"
        ></vaadin-upload-multiple>
        <vaadin-upload-ajax-uploader id="requestDemoUploader"
          files="{{files}}"
          url="https://httpbin.org/post"
          auto
          hidden
        ></vaadin-upload-ajax-uploader>

        <dom-repeat items="[[files]]" as="file">
          <template>
            <vaadin-upload-file-item file="[[file]]"></vaadin-upload-file-item>
          </template>
        </dom-repeat>

        <script>
          window.addDemoReadyListener('#upload-advanced-demos-customizing-the-upload-request', (document) => {
            const uploader = document.querySelector('vaadin-upload-ajax-uploader#requestDemoUploader');

            // Customize the file and Prevent the upload before it starts
            uploader.addEventListener('upload-before', (event) => {
              // Access the file
              // const file = event.detail.file;

              // Prevent the upload request before it starts
              // event.preventDefault();
            });

            // Prevent and Customize the upload before the XHR has been opened
            uploader.addEventListener('upload-preopen', (event) => {
              // Access the file and xhr
              const {file, xhr} = event.detail;

              // Prevent the upload request:
              // event.preventDefault();

              // Properties already set at this point
              // file.uploadTarget
              // file.formDataName

              // Custom upload request url for file
              file.uploadTarget = `${uploader.url}/${file.name}`;

              // Custom name in the Content-Disposition header
              file.formDataName = 'attachment';
            });

            // Prevent and Customize the upload before the XHR is sent
            uploader.addEventListener('upload-preflight', (event) => {
              // Access the file, formData, and xhr
              const {file, formData, xhr} = event.detail;

              // XHR is fully configured at this point but not sent
              xhr.setRequestHeader('X-File-Name', event.detail.file.name);
              formData.append('documentId', 1234);

              // Prevent the default upload request:
              // event.preventDefault();

              // Send file buffer data instead of formData
              // xhr.send(file);
            });

            uploader.addEventListener('upload-start', (event) => {
              // Access the file and xhr
              const {file, xhr} = event.detail;
            });
          });
        </script>
      </template>
    </vaadin-demo-snippet>


    <h3>Sending Files Without Wrapping in FormData</h3>
    <vaadin-demo-snippet id='upload-advanced-demos-sending-files-without-wrapping-in-formdata'>
      <template preserve-content>

        <vaadin-upload-multiple
          files="{{files}}"
        ></vaadin-upload-multiple>
        <vaadin-upload-ajax-uploader id="rawDemoUploader"
          files="{{files}}"
          url="https://httpbin.org/post"
          auto
          hidden
        ></vaadin-upload-ajax-uploader>

        <dom-repeat items="[[files]]" as="file">
          <template>
            <vaadin-upload-file-item file="[[file]]"></vaadin-upload-file-item>
          </template>
        </dom-repeat>

        <script>
          window.addDemoReadyListener('#upload-advanced-demos-sending-files-without-wrapping-in-formdata', document => {
            const uploader = document.querySelector('vaadin-upload-ajax-uploader#rawDemoUploader');

            uploader.addEventListener('upload-preflight', (event) => {
              // Prevent the default upload request:
              event.preventDefault();
              // Send the file's raw data
              event.detail.xhr.send(event.detail.file);
            });
          });
        </script>
      </template>
    </vaadin-demo-snippet>


    <h3>Custom Reaction on Server Response</h3>
    <vaadin-demo-snippet id='upload-advanced-demos-custom-reaction-on-server-response'>
      <template preserve-content>

        <vaadin-upload-multiple
          files="{{files}}"
        ></vaadin-upload-multiple>
        <vaadin-upload-ajax-uploader id="responseDemoUploader"
          files="{{files}}"
          url="https://httpbin.org/post"
          auto
          hidden
        ></vaadin-upload-ajax-uploader>

        <dom-repeat items="[[files]]" as="file">
          <template>
            <vaadin-upload-file-item file="[[file]]"></vaadin-upload-file-item>
          </template>
        </dom-repeat>

        <script>
          window.addDemoReadyListener('#upload-advanced-demos-custom-reaction-on-server-response', (document) => {
            const uploader = document.querySelector('vaadin-upload-ajax-uploader#responseDemoUploader');

            uploader.addEventListener('upload-response', (event) => {
              // Access the file and xhr
              const {file, xhr} = event.detail;

              // Prevent the default upload request:
              event.preventDefault();

              // Customize the upload's error message
              file.status = 'Custom server error message.';
              file.state.errored = true;

              // Interpret any server response as success:
              // event.detail.xhr.status = 200;
            });
          });
        </script>
      </template>
    </vaadin-demo-snippet>


    <h3>Pre-Filling the File List in Advance</h3>
    <vaadin-demo-snippet id='upload-advanced-demos-pre-filling-the-file-list-in-advance'>
      <template preserve-content>
        <vaadin-upload-dropzone>
          <vaadin-upload-multiple id="preFilledDemoUpload"
            slot="upload"
            files="{{prefilledFiles}}"
            accept="application/pdf"
          ></vaadin-upload-multiple>
          <vaadin-upload-ajax-uploader id="preFilledDemoUploader"
            files="{{prefilledFiles}}"
            url="https://httpbin.org/post"
            auto
            hidden
          ></vaadin-upload-ajax-uploader>
          <span>Drop your favourite Novels here</span><br>

          <dom-repeat items="[[prefilledFiles]]" as="file">
            <template>
              <vaadin-upload-file-item file="[[file]]"></vaadin-upload-file-item>
            </template>
          </dom-repeat>
        </vaadin-upload-dropzone>

        <script>
          window.addDemoReadyListener('#upload-advanced-demos-pre-filling-the-file-list-in-advance', (document) => {
            const upload = document.querySelector('vaadin-upload-multiple#preFilledDemoUpload');
            upload.files = [
              {name: 'Don Quixote.pdf', upload: {progress: 100}, state: {completed: true}},
              {name: 'Hamlet.pdf', upload: {progress: 100}, state: {completed: true}},
            ];
            upload.set('i18n.addFiles.many', 'Select books');
          });
        </script>
      </template>
    </vaadin-demo-snippet>


    <h3>Custom Upload Button</h3>
    <vaadin-demo-snippet id='upload-advanced-demos-custom-upload-button'>
      <template preserve-content>
        <vaadin-upload-dropzone>
          <vaadin-upload-multiple id="preFilledDemoUpload"
            slot="upload"
            files="{{files}}"
            max-files="1"
            max-files-reached="{{maxFilesReached}}">
            <button slot="button" disabled$="[[maxFilesReached]]">UPLOAD</button>
        </vaadin-upload-multiple>
          <vaadin-upload-ajax-uploader id="preFilledDemoUploader"
            files="{{files}}"
            url="https://httpbin.org/post"
            auto
            hidden
          ></vaadin-upload-ajax-uploader>
          <span>Drop files here...</span><br>

          <dom-repeat items="[[files]]" as="file">
            <template>
              <vaadin-upload-file-item file="[[file]]"></vaadin-upload-file-item>
            </template>
          </dom-repeat>
        </vaadin-upload-dropzone>
      </template>
    </vaadin-demo-snippet>

  </template>
  <script>
    class UploadAdvancedDemos extends DemoReadyEventEmitter(UploadDemo(Polymer.Element)) {
      static get is() {
        return 'upload-advanced-demos';
      }
    }
    customElements.define(UploadAdvancedDemos.is, UploadAdvancedDemos);
  </script>
</dom-module>
